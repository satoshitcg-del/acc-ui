import { expect, test, describe } from "vitest";

// ฟังก์ชันที่จำลองการทำงานของระบบบัญชี
class ระบบบัญชี {
  private ลูกค้า: Array<{รหัส: string, ชื่อ: string, อีเมล: string}> = [];
  private สินค้า: Array<{รหัส: string, ชื่อ: string, ราคา: number}> = [];
  private บิล: Array<{รหัส: string, ลูกค้า: string, ยอดเงิน: number, สถานะ: string}> = [];

  เพิ่มลูกค้า(รหัส: string, ชื่อ: string, อีเมล: string): boolean {
    if (this.ลูกค้า.find(ล => ล.รหัส === รหัส)) {
      return false; // ลูกค้ามีอยู่แล้ว
    }
    this.ลูกค้า.push({ รหัส, ชื่อ, อีเมล });
    return true;
  }

  เพิ่มสินค้า(รหัส: string, ชื่อ: string, ราคา: number): boolean {
    if (this.สินค้า.find(ส => ส.รหัส === รหัส)) {
      return false; // สินค้ามีอยู่แล้ว
    }
    this.สินค้า.push({ รหัส, ชื่อ, ราคา });
    return true;
  }

  สร้างบิล(รหัส: string, ลูกค้า: string, ยอดเงิน: number): boolean {
    if (this.บิล.find(บ => บ.รหัส === รหัส)) {
      return false; // บิลมีอยู่แล้ว
    }
    this.บิล.push({ รหัส, ลูกค้า, ยอดเงิน, สถานะ: "รอดำเนินการ" });
    return true;
  }

  อัพเดทสถานะบิล(รหัส: string, สถานะใหม่: string): boolean {
    const บิล = this.บิล.find(บ => บ.รหัส === รหัส);
    if (!บิล) {
      return false; // ไม่พบบิล
    }
    บิล.สถานะ = สถานะใหม่;
    return true;
  }

  ดึงรายการลูกค้า(): Array<{รหัส: string, ชื่อ: string, อีเมล: string}> {
    return [...this.ลูกค้า];
  }

  ดึงรายการสินค้า(): Array<{รหัส: string, ชื่อ: string, ราคา: number}> {
    return [...this.สินค้า];
  }

  ดึงรายการบิล(): Array<{รหัส: string, ลูกค้า: string, ยอดเงิน: number, สถานะ: string}> {
    return [...this.บิล];
  }

  คำนวณยอดรวมบิล(): number {
    return this.บิล.reduce((รวม, บิล) => รวม + บิล.ยอดเงิน, 0);
  }

  ค้นหาลูกค้า(คำค้นหา: string): Array<{รหัส: string, ชื่อ: string, อีเมล: string}> {
    return this.ลูกค้า.filter(ลูกค้า => 
      ลูกค้า.ชื่อ.includes(คำค้นหา) || 
      ลูกค้า.อีเมล.includes(คำค้นหา)
    );
  }
}

describe("ระบบบัญชี - เทสเคสการทำงาน", () => {
  let ระบบ: ระบบบัญชี;

  beforeEach(() => {
    ระบบ = new ระบบบัญชี();
  });

  test("ควรเพิ่มลูกค้าใหม่ได้", () => {
    const ผลลัพธ์ = ระบบ.เพิ่มลูกค้า("C001", "บริษัท ตัวอย่าง จำกัด", "info@example.com");
    expect(ผลลัพธ์).toBe(true);
    
    const รายการลูกค้า = ระบบ.ดึงรายการลูกค้า();
    expect(รายการลูกค้า).toHaveLength(1);
    expect(รายการลูกค้า[0].ชื่อ).toBe("บริษัท ตัวอย่าง จำกัด");
  });

  test("ไม่ควรเพิ่มลูกค้าที่มีรหัสซ้ำ", () => {
    ระบบ.เพิ่มลูกค้า("C001", "บริษัท A", "a@example.com");
    const ผลลัพธ์ = ระบบ.เพิ่มลูกค้า("C001", "บริษัท B", "b@example.com");
    
    expect(ผลลัพธ์).toBe(false);
    const รายการลูกค้า = ระบบ.ดึงรายการลูกค้า();
    expect(รายการลูกค้า).toHaveLength(1);
  });

  test("ควรเพิ่มสินค้าใหม่ได้", () => {
    const ผลลัพธ์ = ระบบ.เพิ่มสินค้า("P001", "สินค้า A", 100);
    expect(ผลลัพธ์).toBe(true);
    
    const รายการสินค้า = ระบบ.ดึงรายการสินค้า();
    expect(รายการสินค้า).toHaveLength(1);
    expect(รายการสินค้า[0].ราคา).toBe(100);
  });

  test("ควรสร้างบิลใหม่ได้", () => {
    ระบบ.เพิ่มลูกค้า("C001", "บริษัท A", "a@example.com");
    const ผลลัพธ์ = ระบบ.สร้างบิล("INV-001", "C001", 500);
    
    expect(ผลลัพธ์).toBe(true);
    const รายการบิล = ระบบ.ดึงรายการบิล();
    expect(รายการบิล).toHaveLength(1);
    expect(รายการบิล[0].สถานะ).toBe("รอดำเนินการ");
  });

  test("ควรอัพเดทสถานะบิลได้", () => {
    ระบบ.สร้างบิล("INV-001", "C001", 500);
    const ผลลัพธ์ = ระบบ.อัพเดทสถานะบิล("INV-001", "ชำระแล้ว");
    
    expect(ผลลัพธ์).toBe(true);
    const รายการบิล = ระบบ.ดึงรายการบิล();
    expect(รายการบิล[0].สถานะ).toBe("ชำระแล้ว");
  });

  test("ควรคำนวณยอดรวมบิลได้", () => {
    ระบบ.สร้างบิล("INV-001", "C001", 1000);
    ระบบ.สร้างบิล("INV-002", "C002", 2000);
    ระบบ.สร้างบิล("INV-003", "C003", 500);
    
    const ยอดรวม = ระบบ.คำนวณยอดรวมบิล();
    expect(ยอดรวม).toBe(3500);
  });

  test("ควรค้นหาลูกค้าได้", () => {
    ระบบ.เพิ่มลูกค้า("C001", "บริษัท ตัวอย่าง", "info@example.com");
    ระบบ.เพิ่มลูกค้า("C002", "บริษัท ทดสอบ", "test@example.com");
    ระบบ.เพิ่มลูกค้า("C003", "บริษัท อื่น", "other@example.com");
    
    const ผลลัพธ์การค้นหา = ระบบ.ค้นหาลูกค้า("ตัวอย่าง");
    expect(ผลลัพธ์การค้นหา).toHaveLength(1);
    expect(ผลลัพธ์การค้นหา[0].รหัส).toBe("C001");
  });

  test("ควรจัดการข้อมูลแบบครบวงจร", () => {
    // เพิ่มลูกค้า
    ระบบ.เพิ่มลูกค้า("C001", "บริษัท A", "a@example.com");
    ระบบ.เพิ่มลูกค้า("C002", "บริษัท B", "b@example.com");
    
    // เพิ่มสินค้า
    ระบบ.เพิ่มสินค้า("P001", "สินค้า A", 100);
    ระบบ.เพิ่มสินค้า("P002", "สินค้า B", 200);
    
    // สร้างบิล
    ระบบ.สร้างบิล("INV-001", "C001", 300);
    ระบบ.สร้างบิล("INV-002", "C002", 500);
    
    // อัพเดทสถานะ
    ระบบ.อัพเดทสถานะบิล("INV-001", "ชำระแล้ว");
    
    // ตรวจสอบผลลัพธ์
    expect(ระบบ.ดึงรายการลูกค้า()).toHaveLength(2);
    expect(ระบบ.ดึงรายการสินค้า()).toHaveLength(2);
    expect(ระบบ.ดึงรายการบิล()).toHaveLength(2);
    expect(ระบบ.คำนวณยอดรวมบิล()).toBe(800);
    
    const บิลที่ชำระแล้ว = ระบบ.ดึงรายการบิล().filter(บ => บ.สถานะ === "ชำระแล้ว");
    expect(บิลที่ชำระแล้ว).toHaveLength(1);
  });
});